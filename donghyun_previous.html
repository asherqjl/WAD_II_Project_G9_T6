<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/navbar.css">

    <!-- Custom JavaScript -->
    
    <script src="https://unpkg.com/axios/dist/axios.js"></script>
    <script src="js/attractions_donghyun.js"></script>
    <script src="https://kit.fontawesome.com/fbf5c5a506.js" crossorigin="anonymous"></script>

</head>
<body onload="display_location()">
    <div id="navdiv">
        <nav class="navbar navbar-expand-md">
        
            <div class="container-fluid">
                <a class="navbar-brand">SmilingAcrossLocal<span style="font-size: 11px;"> SG</span></a> 
                
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
            </button>
                
                <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item active"> 
                            <a class="nav-link" aria-current="page" href="#"> LOGIN </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="home.html">HOME</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="KaiWei.html">ATTRACTIONS</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="DongHyun.html">MAPS</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="zenyu.html">TRAVEL HISTORY</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="FangTing.html">REWARDS</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>

    <div class="searchbar">
        <div class="row g-2 my-2">
            <div class="col-md-6 col-sm-6">
                <div class="form-floating ">
                  <select class="form-select" id="floatingSelectGrid" aria-label="Floating label select example" >
                    <option selected></option>
                    <option value="1">Adventure</option>
                    <option value="2">Arts</option>
                    <option value="3">History & Culture</option>
                    <option value="4" onclick="display_leisure()">Leisure & Recreation</option>
                    <option value="5">Nature & Wildlife</option>
                    <option value="6">Others</option>
                  </select>
                  <label for="floatingSelectGrid">Search by category</label>
                </div>
              </div>

            <div class="col-md-6 col-sm-6">
              <div class="form-floating ">
                <select class="form-select" id="floatingSelectGrid" aria-label="Floating label select example" >
                  <option selected></option>
                  <option value="1">North</option>
                  <option value="2">South</option>
                  <option value="3">East</option>
                  <option value="4">West</option>
                </select>
                <label for="floatingSelectGrid">Search by area</label>
              </div>
            </div>

           
        <div class="input-group mb-3 my-3">
            <input type="search" class="form-control me-2" placeholder="Search Attraction" aria-label="Search">
            <button class="btn btn-danger" type="submit" >Search</button>
        </div>


        
        </div>

        <div id="map" class="map-responsive">
        </div>
        <script>
        // Initialize and add the map
        function initMap() {
            // default: The location of SIS, SMU
            var lat = parseFloat(document.getElementById("lat").value);
            var lng = parseFloat(document.getElementById("lng").value);
            // var uluru = {lat: -25.344, lng: 131.036};
            var loc = { lat: lat, lng: lng };

            // The map, centered at SIS, SMU
            var map = new google.maps.Map(
                // play with the zoom value to zoom in or out
                document.getElementById('map'), { zoom: 14, center: loc });
            // The marker, positioned at SIS, SMU
            var marker = new google.maps.Marker({ position: loc, map: map });
        }
    </script>

    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter will contain your own API key 
    * The callback parameter executes the initMap() function
    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDT6sTbyN3xQA9bTHQYcyFVXsqAXT54zfE&callback=initMap"
        async defer></script>

    <div>
    
        <form>
            <div class="form-group">
                <label for="addr">Enter An Address</label>
                <input type="text" class="form-control" name="addr" id="addr"
                    placeholder="E.g. Singapore Management University">
                <br><button type="button" onclick="getLoc()" class="btn btn-primary">Get Full Address!</button>
                <!-- the following set the lat, lng values to put a marker on the map-->
                <input type="hidden" id="lat" name="lat" value="1.2973784" />
                <input type="hidden" id="lng" name="lng" value="103.8495219" />
            </div>
            <p id="display" class="lead text-center"></p>
        </form>
    </div>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        
        
        // Ajax call
        function getLoc() {
            var addr = encodeURI(document.getElementById("addr").value);
            var url = "https://maps.googleapis.com/maps/api/geocode/json?address=" + addr + "&key=AIzaSyDT6sTbyN3xQA9bTHQYcyFVXsqAXT54zfE";

            axios.get(url)
                .then(response => {
                    //console.log(url);
                    //console.log(response.data);    
                    var info = getFullAddress(response.data);

                    document.getElementById("display").innerHTML = info;
                    // refresh the hidden input values with new lat lng coordinates
                    var coordinate = getLatLng(response.data);
                    document.getElementById("lat").value = coordinate["lat"];
                    document.getElementById("lng").value = coordinate["lng"];
                    // now refresh the map
                    initMap();
                })
                .catch(error => {
                    console.log(error);
                    document.getElementById("display").innerHTML = "Sorry, invalid address. Please try again!";
                });
        }

        function getFullAddress(data) {
            var addr = data["results"][0]["formatted_address"];
            var loc = getLatLng(data);
            return addr + "<br> lat: " + loc["lat"] + ", lng: " + loc["lng"];
        }

        function getLatLng(data) {
            var location = data["results"][0]["geometry"]["location"];
            return location;
        }
        
        function display_leisure()  {
            var options = {
            method: 'GET',
            url: 'https://tih-api.stb.gov.sg/content/v1/attractions/search?keyword=Leisure&language=en&apikey=MnqCCPlkgGWec8BPY7FeV8s7MkmBxP4h'
            };
            axios.request(options)
            .then(response=>{
                console.log(response.data.data)
                for (i=0; i<response.data.data.length; i++){
                    
                    var location= response.data.data[i].location
                    new google.maps.Marker({
                        position: new google.maps.LatLng(location.latitude, location.longitude),
                        map:map
                });
                console.log(location);
                console.log(location.latitude);
                console.log(location.longitude);
                }
            
            }).catch(function (error) {
            console.error(error);
            });
            
}
    </script>
        
            
        

        <!-- Footer -->


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

        
</body>
</html>